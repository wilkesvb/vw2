/**
 * Theme Browsing
 *
 * Controls visibility of theme details on manage and install themes pages.
 */jQuery(function(e){e("#availablethemes").on("click",".theme-detail",function(t){var n=e(this).closest(".available-theme"),r=n.find(".themedetaildiv");if(!r.length){r=n.find(".install-theme-info .theme-details");r=r.clone().addClass("themedetaildiv").appendTo(n).hide()}r.toggle();t.preventDefault()})});jQuery(function(e){if(!window.postMessage)return;var t=e("#theme-installer"),n=t.find(".install-theme-info"),r=t.find(".wp-full-overlay-main"),i=e(document.body);t.on("click",".close-full-overlay",function(e){t.fadeOut(200,function(){r.empty();i.removeClass("theme-installer-active full-overlay-active")});e.preventDefault()});t.on("click",".collapse-sidebar",function(e){t.toggleClass("collapsed").toggleClass("expanded");e.preventDefault()});e("#availablethemes").on("click",".install-theme-preview",function(s){var o;n.html(e(this).closest(".installable-theme").find(".install-theme-info").html());o=n.find(".theme-preview-url").val();r.html('<iframe src="'+o+'" />');t.fadeIn(200,function(){i.addClass("theme-installer-active full-overlay-active")});s.preventDefault()})});var ThemeViewer;(function(e){ThemeViewer=function(t){function n(){e("#filter-click, #mini-filter-click").unbind("click").click(function(){e("#filter-click").toggleClass("current");e("#filter-box").slideToggle();e("#current-theme").slideToggle(300);return!1});e("#filter-box :checkbox").unbind("click").click(function(){var t=e("#filter-box :checked").length,n=e("#filter-click").text();n.indexOf("(")!=-1&&(n=n.substr(0,n.indexOf("(")));t==0?e("#filter-click").text(n):e("#filter-click").text(n+" ("+t+")")})}var r={init:n};return r}})(jQuery);jQuery(document).ready(function(e){theme_viewer=new ThemeViewer;theme_viewer.init()});var ThemeScroller;(function(e){ThemeScroller={querying:!1,scrollPollingDelay:500,failedRetryDelay:4e3,outListBottomThreshold:300,init:function(){var t=this;if(typeof ajaxurl=="undefined"||typeof list_args=="undefined"||typeof theme_list_args=="undefined"){e(".pagination-links").show();return}this.nonce=e("#_ajax_fetch_list_nonce").val();this.nextPage=theme_list_args.paged+1;this.$outList=e("#availablethemes");this.$spinner=e("div.tablenav.bottom").children(".spinner");this.$window=e(window);this.$document=e(document);theme_list_args.total_pages>=this.nextPage&&(this.pollInterval=setInterval(function(){return t.poll()},this.scrollPollingDelay))},poll:function(){var e=this.$document.scrollTop()+this.$window.innerHeight();if(this.querying||e<this.$outList.height()-this.outListBottomThreshold)return;this.ajax()},process:function(e){if(e===undefined){clearInterval(this.pollInterval);return}this.nextPage>theme_list_args.total_pages&&clearInterval(this.pollInterval);this.nextPage<=theme_list_args.total_pages+1&&this.$outList.append(e.rows)},ajax:function(){var t=this;this.querying=!0;var n={action:"fetch-list",paged:this.nextPage,s:theme_list_args.search,tab:theme_list_args.tab,type:theme_list_args.type,_ajax_fetch_list_nonce:this.nonce,"features[]":theme_list_args.features,list_args:list_args};this.$spinner.show();e.getJSON(ajaxurl,n).done(function(e){t.nextPage++;t.process(e);t.$spinner.hide();t.querying=!1}).fail(function(){t.$spinner.hide();t.querying=!1;setTimeout(function(){t.ajax()},t.failedRetryDelay)})}};e(document).ready(function(e){ThemeScroller.init()})})(jQuery);